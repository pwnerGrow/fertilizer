<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fertilizer and NPK Profile Calculator</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        input, select, button { margin-bottom: 10px; padding: 5px; }
        button { background-color: #007bff; color: white; border: none; padding: 10px; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        table { border-collapse: collapse; width: 100%; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background-color: #f4f4f4; }
        .result { margin-top: 20px; padding: 10px; border: 1px solid #ccc; background-color: #f9f9f9; }
    </style>
</head>
<body>
    <h1>Fertilizer and NPK Profile Calculator</h1>

    <!-- Input Parameters -->
    <h3>1. Input Parameters</h3>
    <label for="abcRatio">A:B:C Ratio:</label>
    <select id="abcRatio">
        <option value="40:30:30">Seedling (40:30:30)</option>
        <option value="50:25:25">Vegetative (50:25:25)</option>
        <option value="30:40:30">Flowering (30:40:30)</option>
        <option value="20:40:40">Harvest (20:40:40)</option>
    </select>
    <br>
    <label for="waterVolume">Water Volume (liters):</label>
    <input type="number" id="waterVolume" value="100" step="1">
    <button onclick="calculateNPK()">Calculate NPK</button>

    <!-- Result Section -->
    <h3>2. NPK Profile</h3>
    <table id="fertilizerTable">
        <thead>
            <tr>
                <th>Element</th>
                <th>PPM</th>
            </tr>
        </thead>
        <tbody id="profileTable">
        </tbody>
    </table>
    <p id="npkRatio" class="result"></p>

    <script>
        // Nutrient data per gram of each component
        const nutrients = {
            calciumNitrate: { N: 170, Ca: 240 },
            magnesiumSulfate: { Mg: 100, S: 130 },
            potassiumNitrate: { N: 130, K: 460 },
            MKP: { P: 228, K: 280 },
            potassiumSulfate: { K: 500, S: 180 },
            boron: { B: 205 },
            FeEDDHA: { Fe: 60 },
            MnEDTA: { Mn: 125 },
            zincEDTA: { Zn: 130 },
            copperEDTA: { Cu: 130 },
            molybdenum: { Mo: 396 }
        };

        // Stock concentrations for A, B, C (grams per 5L)
        const stockA = { calciumNitrate: 650, boron: 1.5, FeEDDHA: 15 };
        const stockB = { magnesiumSulfate: 850, potassiumNitrate: 450 };
        const stockC = { MKP: 750, potassiumSulfate: 500, molybdenum: 0.08 };

        function calculatePPM(stock, mlPerL) {
            const ppm = {};
            for (const [compound, grams] of Object.entries(stock)) {
                for (const [element, ppmPerGram] of Object.entries(nutrients[compound] || {})) {
                    ppm[element] = (ppm[element] || 0) + (grams * ppmPerGram * mlPerL) / 5000;
                }
            }
            return ppm;
        }

        function calculateNPK() {
            const abcRatio = document.getElementById("abcRatio").value.split(":").map(Number);
            const waterVolume = parseFloat(document.getElementById("waterVolume").value);

            const totalRatio = abcRatio.reduce((a, b) => a + b, 0);
            const mlPerL_A = abcRatio[0] / totalRatio;
            const mlPerL_B = abcRatio[1] / totalRatio;
            const mlPerL_C = abcRatio[2] / totalRatio;

            const ppmA = calculatePPM(stockA, mlPerL_A);
            const ppmB = calculatePPM(stockB, mlPerL_B);
            const ppmC = calculatePPM(stockC, mlPerL_C);

            const totalPPM = { ...ppmA };
            for (const [element, ppm] of Object.entries(ppmB)) {
                totalPPM[element] = (totalPPM[element] || 0) + ppm;
            }
            for (const [element, ppm] of Object.entries(ppmC)) {
                totalPPM[element] = (totalPPM[element] || 0) + ppm;
            }

            const profileTable = document.getElementById("profileTable");
            profileTable.innerHTML = ""; // Clear table

            for (const [element, ppm] of Object.entries(totalPPM)) {
                const row = document.createElement("tr");
                row.innerHTML = `<td>${element}</td><td>${ppm.toFixed(2)}</td>`;
                profileTable.appendChild(row);
            }

            const npkRatio = calculateNPKRatio(totalPPM);
            document.getElementById("npkRatio").textContent = `NPK Ratio: ${npkRatio}`;
        }

        function calculateNPKRatio(ppm) {
            const N = ppm.N || 0;
            const P = ppm.P || 0;
            const K = ppm.K || 0;
            const min = Math.min(N, P, K);
            if (min === 0) return "0:0:0";
            return `${(N / min).toFixed(2)}:${(P / min).toFixed(2)}:${(K / min).toFixed(2)}`;
        }
    </script>
</body>
</html>